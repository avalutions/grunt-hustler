// Generated by CoffeeScript 1.4.0

module.exports = function(grunt) {
  var crypto;
  crypto = require('crypto');
  grunt.registerHelper('hustler template', function(config) {
    var compiled, contents, dest, destination, groups, normalized, separator, sourceContents, src, _results;
    normalized = grunt.helper('hustler normalizeFiles', config);
    groups = normalized.groups;
    config.data.include = grunt.file.read;
    config.data.hash = function(filePath) {
      var contents, hash;
      contents = grunt.file.read(filePath);
      return hash = crypto.createHash('sha1').update(contents).digest('hex').substr(0, 10);
    };
    config.data.uniqueVersion = function() {
      var uniqueVersion;
      return uniqueVersion = (new Date()).getTime();
    };
    _results = [];
    for (dest in groups) {
      src = groups[dest];
      sourceContents = [];
      src.forEach(function(source) {
        var contents;
        contents = grunt.file.read(source);
        return sourceContents.push(contents);
      });
      separator = grunt.utils.linefeed;
      contents = sourceContents.join(grunt.utils.normalizelf(separator));
      compiled = grunt.template.process(contents, {
        config: config.data
      });
      destination = dest.replace('.template', '.html');
      grunt.file.write(destination, compiled);
      _results.push(grunt.verbose.ok("" + src + " -> " + destination));
    }
    return _results;
  });
  return grunt.registerMultiTask('template', 'Compiles templates', function() {
    return grunt.helper('hustler template', this);
  });
};
